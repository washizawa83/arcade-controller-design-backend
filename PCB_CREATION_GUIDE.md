# PCB 作成ガイド - StickLess アーケードコントローラー

## 現在の状況

✅ **利用可能**

- 回路図ファイル (`StickLess.kicad_sch`)
- 基本プロジェクトファイル (`StickLess.kicad_pro`)
- 必要なフットプリントファイル

⚠️ **要修正**

- フットプリント名の不整合
- ライブラリパスの設定

## PCB 作成手順

### 1. KiCad でプロジェクトを開く

```bash
kicad app/datas/StickLess.kicad_pro
```

### 2. フットプリント関連付けの修正（プロジェクト内ローカルライブラリ）

#### 必要な修正:

| 回路図の参照名（例）                | プロジェクト内フットプリント（ローカル）                                  | 備考 |
| ----------------------------------- | ------------------------------------------------------------------------- | ---- |
| `kailh-choc-hotswap:switch_24` など | `app/datas/footprints/kailh-choc-hotswap.pretty/switch_18.kicad_mod`      | 18mm |
|                                     | `app/datas/footprints/kailh-choc-hotswap.pretty/switch_24.kicad_mod`      | 24mm |
|                                     | `app/datas/footprints/kailh-choc-hotswap.pretty/switch_30.kicad_mod`      | 30mm |
| `raspberry-pi-pico:RPi_Pico_SMD_TH` | `app/datas/footprints/raspberry-pi-pico.pretty/RPi_Pico_SMD_TH.kicad_mod` |      |
| `mount:MountingHole_3.2mm_M3`       | `app/datas/footprints/mount.pretty/MountingHole_3.2mm_M3.kicad_mod`       |      |

#### 修正手順:

**方法 1: ローカルライブラリ（fp-lib-table）を利用**

本プロジェクトでは `fp-lib-table` にローカルニックネーム
`local_kailh_choc`／`local_rpi_pico` を定義しています。回路図のフットプリント関連付けで
これらのライブラリから `switch_18/24/30` や `RPi_Pico_SMD_TH` を選択してください。

**方法 2: 回路図で参照変更（推奨）**

1. 回路図エディタを開く
2. ツール → フットプリント関連付けツール
3. 各シンボルのフットプリントを `local_kailh_choc:switch_18/24/30` や
   `local_rpi_pico:RPi_Pico_SMD_TH` に変更

### 3. ネットリスト生成と PCB 作成

1. **ERC チェック実行**

   - ツール → 電気ルールチェック
   - エラーを修正

2. **PCB エディタに更新**

   - ツール → PCB エディタに更新
   - ネットリストが生成され、PCB エディタが開く

3. **部品配置**

   - 自動配置ツールまたは手動で最適配置
   - アーケードコントローラーの物理レイアウトに合わせる

4. **配線（ルーティング）**

   - 自動配線または手動配線
   - 信号の優先度を考慮

5. **基板設計最終化**
   - 基板外形定義
   - シルクスクリーン追加
   - DRC チェック実行

### 4. 想定される基板仕様

**基板サイズ**: アーケードコントローラー筐体に合わせて調整
**層数**: 2 層（表面・裏面）で十分
**部品配置**:

- 中央: RP2040-Zero マイクロコントローラー
- 左側: 方向キー（UP, DOWN, LEFT, RIGHT）
- 右側: アクションボタン（A, B, X, Y 等）
- 端部: L/R ボタン、START/SELECT ボタン
- 四隅: マウンティングホール

**配線優先度**:

1. 電源系統（VCC, GND）
2. 重要な信号線（スイッチ入力）
3. 残りの信号線

### 5. 検証項目

- [ ] 全スイッチが GPIO ピンに正しく接続
- [ ] 電源接続の確認
- [ ] 基板サイズが筐体に適合
- [ ] マウンティングホール位置が正確
- [ ] DRC エラーなし
- [ ] 製造可能性チェック

### 6. 出力ファイル生成

**製造用データ**:

- Gerber ファイル（ガーバーファイル）
- Excellon ドリルファイル
- 部品配置図
- BOM（部品表）

**3D 確認**:

- 3D ビューアで組み立て状態を確認

## 注意事項

⚠️ **重要**: 現在のフットプリントは基本的な形状のみです。実際の製造前には：

1. 部品の正確な寸法確認
2. パッドサイズの最適化
3. ドリル径の確認
4. クリアランスの検証

## トラブルシューティング

**フットプリントが見つからない場合**:

1. プロジェクト設定でライブラリパスを確認
2. フットプリントファイルが正しいディレクトリにあるか確認

**ERC エラーが多数発生する場合**:

1. 電源ピンの接続確認
2. No Connect ピンの処理確認
3. 重複するリファレンス名の修正

**PCB 作成でエラーが発生する場合**:

1. ネットリストの再生成
2. フットプリント関連付けの再確認
3. 回路図の論理エラー修正
